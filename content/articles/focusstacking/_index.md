---
title: "Фокус стекинг или как увеличить глубину резкости"
---

{{< imgr src="focusstacking/scale_2400-1.webp" alt="Кольцо, ювелирное украшение" >}}

Однажды попытавшись сфотографировать предмет с небольшого расстояния, начинающий фотограф сталкивается с «непреодолимой» проблемой. Глубина резкости слишком мала, чтобы детально отразить все особенности объекта съемки.

Ирония в том, что ГРИП, уменьшение которой, фотолюбитель считал достижением, вдруг оказалась помехой. Порывшись в «интернетах», он узнает новый термин: фокус стекинг (focus stacking)… Об этой технологии я коротко расскажу.

Фокус стекинг заключается в создании серии кадров, отличающихся только выбранной на объекте точкой фокусировки. Последующая обработка исходных кадров позволяет получить изображение с достаточной ГРИП. Напомню, ГРИП — глубина резко изображенного пространства. ГРИП зависит от реального фокусного расстояния объектива, расстояния от камеры до объекта и установленного значения диафрагмы.

Что требуется знать о применении технологии «фокус стекинг»? Камера должна быть неподвижна на протяжении съемки всех кадров серии. Снимаемые объекты, тоже, не должны перемещаться. В процессе съемки изменяется только точка фокусировки. Эти ограничения определяют область применения технологии: предметная и макросъемка. В архитектурной и интерьерной съемки, такая технология, как правило, не требуется, но всякое бывает…

Важное замечание. Современные камеры имеют программу «брекетинг фокуса», которая позволяет установить количество кадров и величину смещения точки фокусировки. Камера самостоятельно снимает серию, корректируя смещение точки фокусировки для каждого кадра. Кроме того, она устанавливает величину смещения в зависимости от значения диафрагмы.

## Фокус стекинг ─ технология съемки
Безусловно, автоматические программы облегчают жизнь, но я уверен, что нужно представлять себе, как это работает. Разберемся, что представляет собой фокус стекинг и как его правильно использовать.

{{< imgr src="focusstacking/scale_2400.webp" alt="Кольцо, ювелирное украшение. В фокусе только передняя часть кольца" >}}

Я подготовил пример, для съемки которого, потребуется фокус стекинг. Объект съемки ─ ювелирное украшение ─ кольцо диаметром, примерно, 20 мм. Я воспользуюсь макрообъективом с фокусным расстоянием 150 мм. Так сделано, чтобы получить значительный масштаб изображения. Масштаб, в итоге, составил приблизительно 1:2. Верхний снимок, как вы поняли, результат применения фокус стекинга. Кольцо целиком находится в зоне ГРИП, отчетливо изображен передний план и надпись на заднем плане. Задача, получить полностью резкое изображение в крупном масштабе, с отображением всех деталей объекта, решена.

Нужно сказать, что для съемки было установлено значение диафрагмы f/14.0. Такое значение уже предполагает появление эффекта дифракции для матрицы имеющегося размера и разрешения (FF, 20 мП). Значит закрыть диафрагму еще больше для увеличения ГРИП не получится. Подробней об этом явлении можно узнать по запросу "Дифракционное ограничение диафрагмы".

## Фокус стекинг, съемка исходных кадров
Посмотрим «как все начиналось». Первый кадр (предыдущий раздел) снят с фокусировкой на передней грани кольца. Если оценить величину ГРИП в горизонтальной проекции, то ее величина составляет не больше 2 мм. Нетрудно посчитать сколько всего кадров потребуется. А потребуется 10-12 кадров.

{{< imgr src="focusstacking/scale_2400-2.webp" alt="Кольцо, ювелирное украшение. В фокусе только дальняя часть кольца" >}}

Как подобрать точки фокусировки для последующих кадров? Границы ГРИП в практической фотографии определяются достаточно приблизительно. Существуют формулы, позволяющие аналитически определять ГРИП, но это неудобно и отнимает много времени. Поэтому фотографы доверяют своему опыту.  Во избежание ошибок, точки фокусировки подбирают таким образом, чтобы границы ГРИП смежных кадров гарантировано перекрывались. Слишком большое перекрытие увеличит требуемое количество кадров, недостаточное ─ заставит фотографа все переснять еще раз.

Разница между смежными кадрами невелика, поэтому, для простоты, рассмотрим первый и последний кадры.

Сразу бросается в глаза отличия в размерах объекта… Размер кольца в последнем кадре стал заметно меньше.

Изменение масштаба изображения при смене точек фокусировки, связано с конструкцией длиннофокусного макрообъектива. При фокусировке на минимальных дистанциях, линзовый блок перемещается довольно значительно, при этом изменяется масштаб. Теперь, когда серия кадров готова, пора перейти к обработке, результатом которой должно стать изображение с достаточной глубиной резкости.

**Важное замечание**, *я настоятельно рекомендую не использовать автофокус вашей камеры, особенно, если речь идет о «зеркалке». В первую очередь это касается предметной съемки, где глубина резкости очень мала. Я, обычно, устанавливаю фокус с помощью экрана, используя «live view» и масштабирование изображения на экране камеры или компьютера.*

## Получение результирующего изображения
Для получение результирующего изображения, нужно объединить кадры в одно изображение. Для этого можно использовать ПО производителя вашей камеры, если камера имеет программу «focus bracketing», если нет ─ есть несколько вариантов, не связанных с конструкцией камеры.

{{< imgr src="focusstacking/scale_2400-3.webp" alt="Слои с масками" >}}

### Первый вариант
Специализированные программы, такие как Helicon Focus. Подобные программы, в большинстве случаев, дают приличный результат. Но, когда программа не справляется с задачей, сделать, практически, ничего нельзя. В таких случаях имеет смысл обратится к Photoshop. Его алгоритм работает не так элегантно и часто дает сбои, но всегда есть возможность вмешаться в полученный результат и исправить ошибки.

### Второй вариант
Photoshop собирает результирующий файл в два этапа. Первый этап ─ сборка проекта, в котором исходные файлы представляются в виде слоев. Это делается с помощью команды, доступной в меню File/Automate/Photomerge… Кстати, эта команда предварительно выравнивает слои, в том числе, устраняя несоответствие размеров. Затем используется команда меню Edit/Auto-Align Layers…, которая, так же выравнивает слои. Использование этой команды обязательно не во всех случаях. Завершает обработку команда Edit/Auto-Blend Layers… После обработки каждый слой получает маску, которая определяет его видимость в общем изображении. Выглядит это, как на изображении сверху.

Обнаружив артефакты в результирующем изображении, можно довольно легко устранить их, редактируя маски соответствующих слоев. Но это возможно только, если съемка не содержала грубых технических ошибок. Поэтому рекомендую, проверять визуально расположение зон резкости в исходных файлах.

*Это все, осталось попробовать... примерно сто раз и все станет окончательно понятно. Успехов.*
